<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.hippobookproject.mapper.administrator.AdministratorStickerMapper">
    <select id="selectStickerReqList" resultType="ResultStickerDto">
        SELECT STIKER_ID, STIKER_DATE,USER_ID, USER_NAME, USER_NICKNAME,
               USER_GENDER, USER_AGE, FCNT
        FROM (SELECT STIKER_ID, STIKER_DATE,U.USER_ID, USER_NAME, USER_NICKNAME,
                     USER_GENDER, USER_AGE
              FROM TBL_STICKER S JOIN TBL_USER U
                                      ON
                                    <trim prefix="WHERE" prefixOverrides="AND" >
                                        <if test="selectSticker.startFollowDate != null and selectUser.endFollowDate != null">
                                          TO_CHAR(S.STIKER_DATE, 'YYYY-MM-DD') BETWEEN '2024-05-14' AND '2024-05-14'
                                        </if>
                                        <if test="selectSticker.userName != null">
                                          AND USER_NAME LIKE '%test%'
                                        </if>
                                        <if test="selectSticker.fPermission != null and selectUser.fPermission.length() == 1">
                                          AND STICKER_PERMISSION_CHECK = 'N'
                                        </if>
                                          AND S.USER_ID = U.USER_ID) R
                                    </trim>
                 JOIN (SELECT FOLLOW_TO, COUNT(FOLLOW_FROM) FCNT
                       FROM TBL_FOLLOW
                       GROUP BY FOLLOW_TO) F
                      ON R.USER_ID = F.FOLLOW_TO
    </select>
</mapper>